{
  "hash": "cba0972457b335a8fe35c8eebda9384d",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"주제도 제작의 절차와 지도 디자인\"\nauthor: Sang-Il Lee\ndate-modified: last-modified\nnumber-sections: true\nformat: \n  html: \n    toc: true\ncode-link: true\ncode-copy: true\nexecute: \n  warning: false\n  error: false\n  freeze: auto\neditor: visual\neditor_options: \n  chunk_output_type: console\n---\n\n\n## 주제도 제작의 절차\n\n## 지도 디자인\n\n### 행정구역\n\n#### 데이터 준비\n\n-   필수적인 패키지 불러오기\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse) \nlibrary(readxl) \nlibrary(sf) \nlibrary(tmap)\nlibrary(ggspatial)\n```\n:::\n\n\n-   형상 데이터 불러오기\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsido <- st_read(\"D:/My R/Korean Administrative Areas/행정구역 셰이프 파일/3 Generalization/2020_2Q/SIDO_2020_2Q_GEN_0050.shp\", options = \"ENCODING=CP949\")\nsigun1 <- st_read(\"D:/My R/Korean Administrative Areas/행정구역 셰이프 파일/3 Generalization/2020_2Q/SIGUN1_2020_2Q_GEN_0050.shp\", options = \"ENCODING=CP949\")\nsigungu1 <- st_read(\"D:/My R/Korean Administrative Areas/행정구역 셰이프 파일/3 Generalization/2020_2Q/SIGUNGU1_2020_2Q_GEN_0050.shp\", options = \"ENCODING=CP949\")\nemd <- st_read(\"D:/My R/Korean Administrative Areas/행정구역 셰이프 파일/3 Generalization/2020_2Q/EMD_2020_2Q_GEN_0050.shp\", options = \"ENCODING=CP949\")\nsido_polyline <- st_read(\"D:/My R/Korean Administrative Areas/행정구역 셰이프 파일/3 Generalization/2020_2Q/SIDO_Polyline_2020_2Q_GEN_0050.shp\", options = \"ENCODING=CP949\")\nbbox_ulleung <- st_read(\"D:/My R/Korean Administrative Areas/행정구역 셰이프 파일/3 Generalization/2020_2Q/BBOX_Ulleung_2020_2Q_GEN_0050.shp\", options = \"ENCODING=CP949\")\nbbox_seohae <- st_read(\"D:/My R/Korean Administrative Areas/행정구역 셰이프 파일/3 Generalization/2020_2Q/BBOX_Seohae3_2020_2Q_GEN_0050.shp\", options = \"ENCODING=CP949\")\nseoul_gu <- st_read(\n  \"D:/My R/Korean Administrative Areas/행정구역 셰이프 파일/2 Original Cleaning/2021_4Q/SEOUL_GU_2021_4Q.shp\", options = \"ENCODING=CP949\"\n  ) \nseoul_sido <- st_read(\n  \"D:/My R/Korean Administrative Areas/행정구역 셰이프 파일/2 Original Cleaning/2021_4Q/SEOUL_SIDO_2021_4Q.shp\", options = \"ENCODING=CP949\"\n  )\n```\n:::\n\n\n#### 시도 경계 지도\n\n-   지도 제작\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmy_map <- tm_shape(sido) + tm_polygons() +\n  tm_shape(sido_polyline) + tm_lines(col = \"black\", lwd = 1.75) +\n  tm_shape(bbox_ulleung) + tm_lines() +\n  tm_shape(bbox_seohae) + tm_lines() +\n  tm_layout(inner.margins = c(0.02, 0.02, 0.02, 0.03))\nmy_map \n```\n\n::: {.cell-output-display}\n![](10_map_design_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n\n-   저장\n\n\n::: {.cell}\n\n:::\n\n\n-   `ggplot2`: 지도 제작\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmy_map <- ggplot() +\n  geom_sf(data = sido) +\n  geom_sf(data = sido_polyline) +\n  geom_sf(data = bbox_ulleung) +\n  geom_sf(data = bbox_seohae) +\n  annotation_scale(location = \"br\", bar_cols = c(\"gray40\", \"white\"), width_hint = 0.4) +\n  theme_void() +\n  theme(\n    panel.background = element_rect(color = \"gray20\", fill = \"white\")\n  )\nmy_map\n```\n\n::: {.cell-output-display}\n![](10_map_design_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\n-   `ggplot2`: 저장\n\n\n::: {.cell}\n\n:::\n\n\n#### 시군구 경계 지도\n\n-   지도 제작\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmy_map <- tm_shape(sigungu1) + tm_polygons() +\n  tm_shape(sido_polyline) + tm_lines(col = \"black\", lwd = 1.75) +\n  tm_shape(bbox_ulleung) + tm_lines() +\n  tm_shape(bbox_seohae) + tm_lines() +\n  tm_scale_bar(breaks = seq(0, 200, 50), text.size = 0.5, color.dark = \"gray60\", position = c(0.52, 0.01)) +\n  tm_layout(inner.margins = c(0.02, 0.02, 0.02, 0.03))\nmy_map\n```\n\n::: {.cell-output-display}\n![](10_map_design_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n\n-   저장\n\n\n::: {.cell}\n\n:::\n\n\n-   ggplot2: 지도 제작\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmy_map <- ggplot() +\n  geom_sf(data = sigungu1) +\n  geom_sf(data = sido_polyline) + \n  geom_sf(data = bbox_ulleung) +\n  geom_sf(data = bbox_seohae) +\n  annotation_scale(location = \"br\", bar_cols = c(\"gray40\", \"white\"), width_hint = 0.4) +\n  theme_void() +\n  theme(\n    panel.background = element_rect(color = \"gray20\", fill = \"white\")\n  )\nmy_map\n```\n\n::: {.cell-output-display}\n![](10_map_design_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n\n-   ggplot2: 저장\n\n\n::: {.cell}\n\n:::\n\n\n#### 읍면동 경계 지도\n\n-   지도 제작\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmy_map <- tm_shape(emd) + tm_polygons() +\n  tm_shape(sido_polyline) + tm_lines(col = \"black\", lwd = 1.75) +\n  tm_shape(bbox_ulleung) + tm_lines() +\n  tm_shape(bbox_seohae) + tm_lines() +\n  tm_scale_bar(breaks = seq(0, 200, 50), text.size = 0.5, color.dark = \"gray60\", position = c(0.52, 0.01)) +\n  tm_layout(inner.margins = c(0.02, 0.02, 0.02, 0.03))\nmy_map\n```\n\n::: {.cell-output-display}\n![](10_map_design_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n:::\n\n\n-   저장\n\n\n::: {.cell}\n\n:::\n\n\n-   ggplot2: 지도 제작\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmy_map <- ggplot() +\n  geom_sf(data = emd) +\n  geom_sf(data = sido_polyline) +\n  geom_sf(data = bbox_ulleung) +\n  geom_sf(data = bbox_seohae) +\n  annotation_scale(location = \"br\", bar_cols = c(\"gray40\", \"white\"), width_hint = 0.4) +\n  theme_void() +\n  theme(\n    panel.background = element_rect(color = \"gray20\", fill = \"white\")\n  )\nmy_map\n```\n\n::: {.cell-output-display}\n![](10_map_design_files/figure-html/unnamed-chunk-13-1.png){width=672}\n:::\n:::\n\n\n-   ggplot2: 저장\n\n\n::: {.cell}\n\n:::\n\n\n### 지도 디자인: 예시\n\n#### 데이터 준비\n\n읍면동 단위 인구밀도도\n\n-   형상 데이터 불러오기: 읍면동 변동을 반영한 데이터\n\n\n::: {.cell}\n\n```{.r .cell-code}\nemd_adj <- st_read(\"D:/My R/Korean Administrative Areas/행정구역 셰이프 파일/3 Generalization/2020_Census_Adj/EMD_2020_Census_GEN_0020.shp\", options = \"ENCODING=CP949\")\n```\n:::\n\n\n-   속성 데이터 불러오기: 읍면동 변동을 반영한 데이터\n\n\n::: {.cell}\n\n```{.r .cell-code}\npop_adj <- read_excel(\"D:/My R/Korea Census Data Manipulation/1 Population Basic/DM_ADJ_Census_2020.xlsx\", sheet = 1)\n```\n:::\n\n\n-   결합\n\n\n::: {.cell}\n\n```{.r .cell-code}\nemd_adj <- emd_adj |> \n  mutate(EMD_ID = as.numeric(EMD_ID))\nemd_adj_data <- emd_adj |> \n  left_join(pop_adj, join_by(EMD_ID == Code)) |> \n  mutate(\n    pop_t = ifelse(is.na(pop_t), 0, pop_t)\n  )\n```\n:::\n\n\n-   인구밀도 계산\n\n\n::: {.cell}\n\n```{.r .cell-code}\nemd_adj_data <- emd_adj_data |>\n  mutate(\n     area = geometry |> st_area() |> as.numeric()/1000000,\n     pop_den = pop_t / area\n  )\n```\n:::\n\n\n-   지도 제작\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nbbox_ulleung_polygon <- bbox_ulleung |> \n  st_cast(\"POLYGON\")\n\nmy_map <- tm_graticules(col = \"white\", x = seq(126, 130, 1), y = seq(33, 39, 1)) +\n  tm_shape(bbox_ulleung_polygon) + tm_borders() + tm_fill(\"gray90\") +\n  tm_shape(emd_adj_data, is.master = TRUE) +\n  tm_polygons(col = \"pop_den\", breaks = c(0, 50, 250, 500, 1000, 5000, 10000, Inf),\n              palette = \"YlGnBu\", title = \"People per square km\",\n              # title = expression(paste(\"People / \", \"km\"^\"2\")),\n              border.col = NULL) +\n  tm_shape(sigungu1) + tm_borders() +\n  tm_shape(sido_polyline) + tm_lines(col = \"black\", lwd = 1.75) +\n  tm_shape(bbox_seohae) + tm_lines() +\n  tm_legend(legend.position = c(0.65, 0.06), legend.bg.color = \"white\",\n            legend.title.size = 1.5, legend.text.size = 1.2) +\n  tm_layout(bg.color = \"gray90\",\n            title = \"Population Distribution, 2020\", title.size = 1.8,\n            inner.margins = c(0.07, 0.1, 0.05, 0.07)) +\n  tm_scale_bar(breaks = seq(0, 200, 50), text.size = 0.5, color.dark = \"gray60\", position = c(0.52, 0.01)) +\n  tm_credits(\"SANG-IL LEE, Geography Education at SNU, 2024\", size = 0.7, position = c(0.025, 0.01))\n\nmy_map\n```\n\n::: {.cell-output-display}\n![](10_map_design_files/figure-html/unnamed-chunk-19-1.png){fig-align='center' width=70%}\n:::\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# 위와 같이 설정한다고 해도 Plots 창의 것과 렌더링 이후의 것이 같지 않음(ggplot2와 다른 점). \n# 렌더링 결과도 동일함(ggplot2와 다른 점.\n\nbbox_ulleung_polygon <- bbox_ulleung |> \n  st_cast(\"POLYGON\")\n\nmy_map <- tm_graticules(col = \"white\", x = seq(126, 130, 1), y = seq(33, 39, 1)) +\n  tm_shape(bbox_ulleung_polygon) + tm_borders() + tm_fill(\"gray90\") +\n  tm_shape(emd_adj_data, is.master = TRUE) +\n  tm_polygons(col = \"pop_den\", breaks = c(0, 50, 250, 500, 1000, 5000, 10000, Inf),\n              palette = \"YlGnBu\", title = \"People per square km\",\n              # title = expression(paste(\"People / \", \"km\"^\"2\")),\n              border.col = NULL) +\n  tm_shape(sigungu1) + tm_borders() +\n  tm_shape(sido_polyline) + tm_lines(col = \"black\", lwd = 1.75) +\n  tm_shape(bbox_seohae) + tm_lines() +\n  tm_legend(legend.position = c(0.65, 0.06), legend.bg.color = \"white\",\n            legend.title.size = 1.5, legend.text.size = 1.2) +\n  tm_layout(bg.color = \"gray90\",\n            title = \"Population Distribution, 2020\", title.size = 1.8,\n            inner.margins = c(0.07, 0.1, 0.05, 0.07)) +\n  tm_scale_bar(breaks = seq(0, 200, 50), text.size = 0.5, color.dark = \"gray60\", position = c(0.52, 0.01)) +\n  tm_credits(\"SANG-IL LEE, Geography Education at SNU, 2024\", size = 0.7, position = c(0.025, 0.01))\n\nmy_map\n```\n\n::: {.cell-output-display}\n![](10_map_design_files/figure-html/unnamed-chunk-20-1.png){fig-align='center' width=70%}\n:::\n:::\n\n\n-   저장\n\n\n::: {.cell}\n\n:::\n\n\n-   `ggplot2`: 지도 제작\n\n\n::: {.cell}\n\n```{.r .cell-code}\nemd_adj_data_1 <- emd_adj_data |> \n  mutate(\n    pop_den = cut(pop_den, \n                  breaks = c(-Inf, 50, 250, 500, 1000, 5000, 10000, Inf),\n                  labels = c(\"0 to 50\", \"50 to 250\", \"250 to 500\", \"500 to 1,000\", \n                             \"1,000 to 5,000\", \"5,000 to 10,000\", \"10,000 or more\"))\n  )\n\nmy_map <- ggplot() + \n  geom_sf(data = bbox_ulleung_polygon, fill = \"gray92\", lwd = 0.1) +\n  geom_sf(\n    data = emd_adj_data_1, aes(fill = pop_den), color = NA) +\n  geom_sf(data = sigungu1, fill = NA) +\n  geom_sf(data = sido_polyline) +\n  geom_sf(data = bbox_seohae, lwd = 0.1) +\n  theme(\n    legend.position = \"inside\",\n    legend.position.inside = c(0.85, 0.15),\n    legend.background = element_rect(fill = \"white\")) +\n  scale_fill_brewer(palette = \"YlGnBu\", name = expression(paste(\"People / \", \"km\"^\"2\"))) +\n  labs(\n    title = \"Population Density, 2020\", \n    x = \"\", y = \"\", caption = \"SANG-IL LEE, Geography Education at SNU, 2024\") +\n  annotate(\"text\", x = -Inf, y = Inf, hjust = -0.05, vjust = 2, size = 7.5,   \n           label = \"Population Distribution, 2020\") +\n  annotate(\"text\", x = -Inf, y = -Inf, hjust = -0.1, vjust = -1.5, size = 3.5,   \n           label = \"SANG-IL LEE, Geography Education at SNU, 2024\") +\n  annotation_scale(location = \"br\", bar_cols = c(\"gray40\", \"white\"), width_hint = 0.4, pad_y = unit(0.5, \"cm\"))\nmy_map\n```\n\n::: {.cell-output-display}\n![](10_map_design_files/figure-html/unnamed-chunk-22-1.png){width=672}\n:::\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# 위와 같이 세 가지를 지정하면 Plots 창에 그려진 것과 거의 동일한 것이 Quarto 렌더링에 나타남(tmap은 다 다름). \n# 렌더링 결과는 이게 더 좋아 보임.\n \nemd_adj_data_1 <- emd_adj_data |> \n  mutate(\n    pop_den = cut(pop_den, \n                  breaks = c(-Inf, 50, 250, 500, 1000, 5000, 10000, Inf),\n                  labels = c(\"0 to 50\", \"50 to 250\", \"250 to 500\", \"500 to 1,000\", \n                             \"1,000 to 5,000\", \"5,000 to 10,000\", \"10,000 or more\"))\n  )\n\nmy_map <- ggplot() + \n  geom_sf(data = bbox_ulleung_polygon, fill = \"gray92\", lwd = 0.1) +\n  geom_sf(\n    data = emd_adj_data_1, aes(fill = pop_den), color = NA) +\n  geom_sf(data = sigungu1, fill = NA) +\n  geom_sf(data = sido_polyline) +\n  geom_sf(data = bbox_seohae, lwd = 0.1) +\n  theme(\n    legend.position = \"inside\",\n    legend.position.inside = c(0.85, 0.18),\n    legend.background = element_rect(fill = \"white\")) +\n  scale_fill_brewer(palette = \"YlGnBu\", name = expression(paste(\"People / \", \"km\"^\"2\"))) +\n  labs(x = \"\", y = \"\") +\n  annotate(\"text\", x = -Inf, y = Inf, hjust = -0.05, vjust = 2, size = 5,   \n           label = \"Population Distribution, 2020\") +\n  annotate(\"text\", x = -Inf, y = -Inf, hjust = -0.1, vjust = -1.5, size = 2,   \n           label = \"SANG-IL LEE, Geography Education at SNU, 2024\") +\n  annotation_scale(location = \"br\", bar_cols = c(\"gray40\", \"white\"), width_hint = 0.4, pad_y = unit(0.2, \"cm\"))\nmy_map\n```\n\n::: {.cell-output-display}\n![](10_map_design_files/figure-html/unnamed-chunk-23-1.png){fig-align='center' width=70%}\n:::\n:::\n\n::: {.cell}\n\n:::\n\n\n-   `ggplot2`: 저장\n\n\n::: {.cell}\n\n:::\n",
    "supporting": [
      "10_map_design_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}