{
  "hash": "615eb82066b72e3e38235b983056d6df",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"도형표현도\"\nauthor: Sang-Il Lee\ndate-modified: last-modified\nnumber-sections: true\nformat: \n  html: \n    toc: true\ncode-link: true\ncode-copy: true\nexecute: \n  warning: false\n  error: false\n  freeze: auto\neditor: visual\neditor_options: \n  chunk_output_type: console\n---\n\n\n## 기본 개념\n\n### 지도 제작 데이터\n\n-   필수적인 패키지\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse) \nlibrary(readxl) \nlibrary(sf) \nlibrary(tmap)\nlibrary(ggspatial)\n```\n:::\n\n\n-   형상 데이터 불러오기\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsido <- st_read(\"D:/My R/Korean Administrative Areas/행정구역 셰이프 파일/3 Generalization/2020_2Q/SIDO_2020_2Q_GEN_0050.shp\", options = \"ENCODING=CP949\")\nsigun1 <- st_read(\"D:/My R/Korean Administrative Areas/행정구역 셰이프 파일/3 Generalization/2020_2Q/SIGUN1_2020_2Q_GEN_0050.shp\", options = \"ENCODING=CP949\")\nsigungu1 <- st_read(\"D:/My R/Korean Administrative Areas/행정구역 셰이프 파일/3 Generalization/2020_2Q/SIGUNGU1_2020_2Q_GEN_0050.shp\", options = \"ENCODING=CP949\")\nemd <- st_read(\"D:/My R/Korean Administrative Areas/행정구역 셰이프 파일/3 Generalization/2020_2Q/EMD_2020_2Q_GEN_0050.shp\", options = \"ENCODING=CP949\")\nsido_polyline <- st_read(\"D:/My R/Korean Administrative Areas/행정구역 셰이프 파일/3 Generalization/2020_2Q/SIDO_Polyline_2020_2Q_GEN_0050.shp\", options = \"ENCODING=CP949\")\nbbox_ulleung <- st_read(\"D:/My R/Korean Administrative Areas/행정구역 셰이프 파일/3 Generalization/2020_2Q/BBOX_Ulleung_2020_2Q_GEN_0050.shp\", options = \"ENCODING=CP949\")\nbbox_seohae <- st_read(\"D:/My R/Korean Administrative Areas/행정구역 셰이프 파일/3 Generalization/2020_2Q/BBOX_Seohae3_2020_2Q_GEN_0050.shp\", options = \"ENCODING=CP949\")\nseoul_gu <- st_read(\n  \"D:/My R/Korean Administrative Areas/행정구역 셰이프 파일/2 Original Cleaning/2021_4Q/SEOUL_GU_2021_4Q.shp\", options = \"ENCODING=CP949\"\n  ) \nseoul_sido <- st_read(\n  \"D:/My R/Korean Administrative Areas/행정구역 셰이프 파일/2 Original Cleaning/2021_4Q/SEOUL_SIDO_2021_4Q.shp\", options = \"ENCODING=CP949\"\n  )\n```\n:::\n\n\n-   인구 데이터\n\n\n::: {.cell}\n\n```{.r .cell-code}\npop_SDGG <- read_excel(path = \"D:/My R/Population Geography/1 Population Growth/POP_1975_2021_SDGG.xlsx\")\npop_data <- pop_SDGG |> \n  select(Code, Region, pop_2015 = `2015`, pop_2020 = `2020`) |> \n  mutate(\n    pgr = 0.2*log(pop_2020/pop_2015) * 100\n  )\n```\n:::\n\n\n-   면적 데이터\n\n\n::: {.cell}\n\n```{.r .cell-code}\narea_data <- read_excel(path = \"D:/My R/Korea Census Data Manipulation/11 Etc/DM_AREA_2020_SDGG.xlsx\")\n```\n:::\n\n\n-   시군구1과 연결\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmy_sgg_data <- sigungu1 |> \n  left_join(pop_data, join_by(SGG1_CD == Code)) |> \n  left_join(\n    select(area_data, SDGG_CD, Area), join_by(SGG1_CD == SDGG_CD)\n  ) |> \n  mutate(\n    pop_den = pop_2020/(Area/1000000)\n  )\n```\n:::\n\n\n-   시군1과 연결\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmy_sg_data <- sigun1 |> \n  left_join(pop_data, join_by(SG1_CD == Code)) |> \n  left_join(\n    select(area_data, SDGG_CD, Area), join_by(SG1_CD == SDGG_CD)\n  ) |> \n  mutate(\n    pop_den = pop_2020/(Area/1000000)\n  )\n```\n:::\n\n\n### 도형표현도의 기본 원리\n\n-   구 행정 구역 지도: 제작\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmy_map <- tm_shape(seoul_gu) + tm_polygons()\nmy_map\n```\n\n::: {.cell-output-display}\n![](11_proportional_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n\n-   구 행정 구역 지도: 저장\n\n\n::: {.cell}\n\n:::\n\n\n-   센트로이드 지도: 지도 제작\n\n\n::: {.cell}\n\n```{.r .cell-code}\nseoul_gu_pop <- seoul_gu |> \n  left_join(pop_data, join_by(SGG1_CD == Code)) |> \n  left_join(\n    select(area_data, SDGG_CD, Area), join_by(SGG1_CD == SDGG_CD)\n  ) |> \n  mutate(\n    pop_den = pop_2020/(Area/1000000)\n  )\n  \nseoul_gu_cent <- st_centroid(seoul_gu_pop)\nmy_map <- tm_shape(seoul_gu) + tm_polygons() +\n  tm_shape(seoul_gu_cent) + \n  tm_dots(size = 0.5)\nmy_map\n```\n\n::: {.cell-output-display}\n![](11_proportional_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n\n-   센트로이드 지도: 저장\n\n\n::: {.cell}\n\n:::\n\n\n-   인구 도형표현도: 지도 제작\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmy_map <- tm_shape(seoul_gu_pop) + tm_polygons() +\n  tm_symbols(\n    size = \"pop_2020\", scale = 8, legend.size.show = FALSE, alpha = 0.8\n  )\nmy_map\n```\n\n::: {.cell-output-display}\n![](11_proportional_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n:::\n\n\n-   인구 도형표현도: 저장\n\n\n::: {.cell}\n\n:::\n\n\n-   인구밀도도: 지도 제작\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmy_map <- tm_shape(seoul_gu_pop) + \n  tm_polygons(\n    col = \"pop_den\",\n    palette = \"Greys\", \n    style = \"pretty\",\n    legend.show = FALSE\n    # breaks = c(0, 10000, 15000, 20000, 25000, 30000, 35000, Inf), \n    # labels = c(\"< 10,000\", \"10,000 ~ 15,000\", \"15,000 ~ 20,000\", \"20,000 ~ 25,000\", \n    #            \"25,000 ~ 30,000\", \"30,000 ~ 35,000\", \">= 35,000\")\n  )\nmy_map\n```\n\n::: {.cell-output-display}\n![](11_proportional_files/figure-html/unnamed-chunk-13-1.png){width=672}\n:::\n:::\n\n\n-   인구밀도도: 저장\n\n\n::: {.cell}\n\n:::\n\n\n### 비례 심볼의 척도화\n\n### 원과 사각형\n\n-   강원도 시군 데이터\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngangwon_sgg <- my_sgg_data |> \n  filter(SD_CD == 32)\n```\n:::\n\n\n-   원: 지도 제작\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmy_map <- tm_shape(gangwon_sgg) + tm_borders() +\n  tm_symbols(\n    size = \"pop_2020\", scale = 9, \n    border.col = \"gray20\", alpha = 0.8, \n    legend.size.show = FALSE\n  ) +\n  tm_layout(\n    title = \"Symbol: Circle\", title.size = 1.8\n  ) +\n  tm_scale_bar(breaks = seq(0, 50, 10), text.size = 0.4, color.dark = \"gray60\", position = c(0.025, 0.05)) +\n  tm_credits(\"SANG-IL LEE, Geography Education at SNU, 2024\", size = 0.8, position = c(0.025, 0.01))\nmy_map\n```\n\n::: {.cell-output-display}\n![](11_proportional_files/figure-html/unnamed-chunk-16-1.png){width=672}\n:::\n:::\n\n\n-   원: 저장\n\n\n::: {.cell}\n\n:::\n\n\n-   정사각형: 지도 제작\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmy_map <- tm_shape(gangwon_sgg) + tm_borders() +\n  tm_symbols(\n    size = \"pop_2020\", scale = 9, shape = 22,\n    border.col = \"gray20\", alpha = 0.8, \n    legend.size.show = FALSE\n  ) +\n  tm_layout(\n    title = \"Symbol: Square\", title.size = 1.8\n  ) +\n  tm_scale_bar(breaks = seq(0, 50, 10), text.size = 0.4, color.dark = \"gray60\", position = c(0.025, 0.05)) +\n  tm_credits(\"SANG-IL LEE, Geography Education at SNU, 2024\", size = 0.8, position = c(0.025, 0.01))\nmy_map\n```\n\n::: {.cell-output-display}\n![](11_proportional_files/figure-html/unnamed-chunk-18-1.png){width=672}\n:::\n:::\n\n\n-   정사각형: 저장\n\n\n::: {.cell}\n\n:::\n\n\n### 척도법: 절대적 vs. 인지적\n\n-   절대적 척도법: 지도 제작\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmy_map <- tm_shape(gangwon_sgg) + tm_borders() +\n  tm_symbols(\n    size = \"pop_2020\", scale = 9, \n    border.col = \"gray20\", alpha = 0.8, \n    legend.size.show = TRUE,\n    legend.size.is.portrait = TRUE,\n    sizes.legend = c(50000, 100000, 200000, 300000), \n    sizes.legend.labels = c(\"50,000\", \"100,000\", \"200,000\", \"300,000\"),\n    title.size = \"Population (2020)\"\n  ) +\n  tm_layout(\n    title = \"Absolute Scaling\", title.size = 1.8\n  ) +\n  tm_scale_bar(breaks = seq(0, 50, 10), text.size = 0.4, color.dark = \"gray60\", position = c(0.025, 0.05)) +\n  tm_credits(\"SANG-IL LEE, Geography Education at SNU, 2024\", size = 0.8, position = c(0.025, 0.01))\nmy_map\n```\n\n::: {.cell-output-display}\n![](11_proportional_files/figure-html/unnamed-chunk-20-1.png){width=672}\n:::\n:::\n\n\n-   절대적 척도법: 저장\n\n\n::: {.cell}\n\n:::\n\n\n-   인지적 척도법: 지도 제작\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmy_map <- tm_shape(gangwon_sgg) + tm_borders() +\n  tm_symbols(\n    size = \"pop_2020\", scale = 9, perceptual = TRUE, \n    border.col = \"gray20\", alpha = 0.8, \n    legend.size.show = TRUE,\n    legend.size.is.portrait = TRUE,\n    sizes.legend = c(50000, 100000, 200000, 300000), \n    sizes.legend.labels = c(\"50,000\", \"100,000\", \"200,000\", \"300,000\"),\n    title.size = \"Population (2020)\"\n  ) +\n  tm_layout(\n    title = \"Perceptual Scaling\", title.size = 1.8\n  ) +\n  tm_scale_bar(breaks = seq(0, 50, 10), text.size = 0.4, color.dark = \"gray60\", position = c(0.025, 0.05)) +\n  tm_credits(\"SANG-IL LEE, Geography Education at SNU, 2024\", size = 0.8, position = c(0.025, 0.01))\nmy_map\n```\n\n::: {.cell-output-display}\n![](11_proportional_files/figure-html/unnamed-chunk-22-1.png){width=672}\n:::\n:::\n\n\n-   인지적 척도법: 저장\n\n\n::: {.cell}\n\n:::\n\n\n## 다양한 도형 표현도\n\n### 2020년 시군1 단위 도형표현도: 비례형\n\n-   지도 제작\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nmy_map <- tm_shape(my_sg_data) + tm_borders() +\n  tm_shape(sido_polyline) + tm_lines(col = \"black\", lwd = 2) +\n  tm_shape(bbox_ulleung) + tm_lines(col = \"black\") +\n  tm_shape(bbox_seohae) + tm_lines(col = \"black\") +\n  tm_shape(my_sg_data) + \n  tm_symbols(size = \"pop_2020\", scale = 10, \n             col = \"gray50\", border.col = \"gray20\", alpha = 0.8, \n             sizes.legend = c(500000, 3000000, 10000000), sizes.legend.labels = c(\"50\", \"300\", \"1,000\"), \n             size.max = 11000000,  \n             legend.size.is.portrait = FALSE, title.size = \"Population (10,000 Persons)\"\n             ) +\n  tm_legend(\n    legend.title.size = 1.25, \n    legend.text.size = 0.8, \n    legend.width = 0.7, \n    legend.position = c(0.6, 0.06)\n  ) +\n  tm_layout(\n    title = \"Population Distribution, 2020\", title.size = 1.8,\n    inner.margins = c(0.05, 0.025, 0.07, 0.05)\n  ) +\n  tm_scale_bar(breaks = seq(0, 200, 50), text.size = 0.4, color.dark = \"gray60\", position = c(0.53, 0.01)) +\n  tm_credits(\"SANG-IL LEE, Geography Education at SNU, 2024\", size = 0.8, position = c(0.025, 0.01))\nmy_map\n```\n\n::: {.cell-output-display}\n![](11_proportional_files/figure-html/unnamed-chunk-24-1.png){fig-align='center' width=70%}\n:::\n:::\n\n\n-   저장\n\n\n::: {.cell}\n\n:::\n\n\n### 2020년 시군1 단위 도형포현도: 등급형\n\n-   지도 제작\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nmy_sg_data_1 <- my_sg_data |> \n  mutate(\n    pop_2020_class = case_when(\n      pop_2020 < 100000 ~ 25000,\n      pop_2020 >= 100000 & pop_2020 < 250000 ~ 150000,\n      pop_2020 >= 250000 & pop_2020 < 500000 ~ 300000,\n      pop_2020 >= 500000 & pop_2020 < 1000000 ~ 700000,\n      pop_2020 >= 1000000 & pop_2020 < 3000000 ~ 1500000,\n      pop_2020 >= 3000000 ~ 3000000\n    )\n  )\n\nmy_map <- tm_shape(my_sg_data_1) + tm_borders() +\n  tm_shape(sido_polyline) + tm_lines(col = \"black\", lwd = 2) +\n  tm_shape(bbox_ulleung) + tm_lines(col = \"black\") +\n  tm_shape(bbox_seohae) + tm_lines(col = \"black\") +\n  tm_shape(my_sg_data_1) + \n  tm_symbols(size = \"pop_2020_class\", scale = 10, \n             col = \"gray50\", border.col = \"gray20\", alpha = 0.8, \n             sizes.legend = c(25000, 150000, 300000, 700000, 1500000, 3000000), \n             sizes.legend.labels = c(\"< 10\", \"10~25\", \"25~50\", \n                                     \"50~100\", \"100~300\", \">= 300\"), \n             size.max = 8000000,  \n             legend.size.is.portrait = FALSE, title.size = \"Population (10,000 Persons)\"\n             ) +\n  tm_legend(\n    legend.title.size = 1.25, \n    legend.text.size = 0.8, \n    legend.width = 0.8, \n    legend.position = c(0.45, 0.05)\n  ) +\n  tm_layout(\n    title = \"Population Distribution, 2020\", title.size = 1.8,\n    inner.margins = c(0.05, 0.025, 0.07, 0.05)\n  ) +\n  tm_scale_bar(breaks = seq(0, 200, 50), text.size = 0.4, color.dark = \"gray60\", position = c(0.53, 0.01)) +\n  tm_credits(\"SANG-IL LEE, Geography Education at SNU, 2024\", size = 0.8, position = c(0.025, 0.01))\nmy_map\n```\n\n::: {.cell-output-display}\n![](11_proportional_files/figure-html/unnamed-chunk-26-1.png){fig-align='center' width=70%}\n:::\n:::\n\n\n-   저장\n\n\n::: {.cell}\n\n:::\n\n\n## 도형표현도의 확장\n\n### 인구규모와 인구성장률\n\n-   지도 제작\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nmy_map <- tm_shape(my_sg_data) + tm_polygons(col = \"gray98\") +\n  tm_shape(sido_polyline) + tm_lines(col = \"black\", lwd = 2) +\n  tm_shape(bbox_ulleung) + tm_lines(col = \"black\") +\n  tm_shape(bbox_seohae) + tm_lines(col = \"black\") +\n  tm_shape(my_sg_data) + \n  tm_symbols(size = \"pop_2020\", scale = 10, \n             col = \"pgr\", palette = \"-RdBu\",\n             breaks = c(-Inf, -2, -1, 0, 1, 2, Inf),\n             labels = c(\"< -2\", \"-2 ~ -1\", \"-1 ~ 0\", \"0 ~ 1\", \"1 ~ 2\", \">= 2\"),\n             border.col = \"gray20\", alpha = 0.8, \n             sizes.legend = c(500000, 3000000, 10000000), \n             sizes.legend.labels = c(\"500,000\", \"3,000,000\", \"10,000,000\"), \n             size.max = 11000000,  \n             shapes.legend.fill = \"gray90\",\n             legend.size.is.portrait = FALSE, \n             legend.col.z = 1, \n             legend.size.z = 2, \n             title.size = \"Population (2020)\",\n             title.col = \"PGR (%, 2015~2020)\"\n             ) +\n  tm_legend(\n    legend.stack = \"vertical\",\n    legend.title.size = 1.25, \n    legend.text.size = 0.8, \n    legend.width = 0.8, \n    legend.position = c(0.58, 0.025)\n  ) +\n  tm_layout(\n    title = \"Population Distribution and Growth\", title.size = 1.8,\n    inner.margins = c(0.1, 0.05, 0.07, 0.07)\n    # inner.margins = c(0.05, 0.025, 0.07, 0.05)\n  ) +\n  tm_scale_bar(breaks = seq(0, 200, 50), text.size = 0.4, \n               color.dark = \"gray60\", position = c(0.53, 0.005)) +\n  tm_credits(\"SANG-IL LEE, Geography Education at SNU, 2024\", \n             size = 0.8, position = c(0.025, 0.005))\nmy_map\n```\n\n::: {.cell-output-display}\n![](11_proportional_files/figure-html/unnamed-chunk-28-1.png){fig-align='center' width=70%}\n:::\n:::\n\n\n-   저장\n\n\n::: {.cell}\n\n:::\n",
    "supporting": [
      "11_proportional_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}