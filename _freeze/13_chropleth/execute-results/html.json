{
  "hash": "50339121e12049528ead71e8f1c479e6",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"코로플레스맵\"\nauthor: Sang-Il Lee\ndate-modified: last-modified\nnumber-sections: true\nformat: \n  html: \n    toc: true\ncode-link: true\ncode-copy: true\nexecute: \n  warning: false\n  error: false\n  freeze: auto\neditor: visual\neditor_options: \n  chunk_output_type: console\n---\n\n\n## 기본 개념\n\n## 계급구분 방법\n\n### 지도 제작 데이터\n\n#### 필수적인 패키지\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse) \nlibrary(readxl) \nlibrary(sf) \nlibrary(tmap) \nlibrary(rnaturalearth)\n```\n:::\n\n\n#### 우리나라 데이터\n\n-   도형 데이터\n\n\n::: {.cell}\n\n```{.r .cell-code}\nseoul_EMD_2020 <- st_read(\n  \"D:/My R/Korean Administrative Areas/행정구역 셰이프 파일/2 Original Cleaning/2020_2Q/SEOUL_EMD_2020_2Q.shp\", options = \"ENCODING=CP949\"\n  ) \nseoul_gu <- st_read(\n  \"D:/My R/Korean Administrative Areas/행정구역 셰이프 파일/2 Original Cleaning/2021_4Q/SEOUL_GU_2021_4Q.shp\", options = \"ENCODING=CP949\"\n  ) \nseoul_sido <- st_read(\n  \"D:/My R/Korean Administrative Areas/행정구역 셰이프 파일/2 Original Cleaning/2021_4Q/SEOUL_SIDO_2021_4Q.shp\", options = \"ENCODING=CP949\"\n  )\n```\n:::\n\n\n-   속성 데이터: 1인가구 비중\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhouse_SDGGEMD_2020 <- read_excel(\n  \"D:/My R/Population Geography/3 Population Structure/Housing_Size_2020_Adj.xlsx\", sheet = 1\n  )\n```\n:::\n\n\n-   결합하기\n\n\n::: {.cell}\n\n```{.r .cell-code}\nseoul_EMD_2020 <- seoul_EMD_2020 |> \n  mutate(\n    EMD_ID = as.numeric(EMD_ID)\n  )\nseoul_df <-seoul_EMD_2020 |> \n  left_join(\n    house_SDGGEMD_2020, join_by(EMD_ID == Code)\n  )\n```\n:::\n\n\n#### 세계 데이터\n\n-   도형 데이터\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncountries_m <- st_read(\"D:/My R/World Data Manupulation/NaturalEarth/new_2_ne_50m_admin_0_countries.shp\") \n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nReading layer `new_2_ne_50m_admin_0_countries' from data source \n  `D:\\My R\\World Data Manupulation\\NaturalEarth\\new_2_ne_50m_admin_0_countries.shp' \n  using driver `ESRI Shapefile'\nSimple feature collection with 239 features and 170 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: -180 ymin: -89.99893 xmax: 180 ymax: 83.59961\nGeodetic CRS:  WGS 84\n```\n\n\n:::\n\n```{.r .cell-code}\ntiny_m <- ne_download(scale = \"medium\", type = \"tiny_countries\", category = \"cultural\", returnclass = \"sf\")\ngrat_bb_m <- ne_download(scale = \"medium\", type = \"wgs84_bounding_box\", category = \"physical\", returnclass = \"sf\")\ngrat_10_m <- ne_download(scale = \"medium\", type = \"graticules_10\", category = \"physical\", returnclass = \"sf\")\ngrat_30_m <- ne_download(scale = \"medium\", type = \"graticules_30\", category = \"physical\", returnclass = \"sf\")\n\ntiny_m <- tiny_m |> \n  mutate(\n    ISO_N3_CD = as.numeric(ISO_N3)\n  )\n```\n:::\n\n\n-   속성 데이터: TFR(1955, 2024, 2050, 2100)\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwpp_2022 <- read_rds(\"wpp_2022.rds\")\nwpp_TFR <- wpp_2022 |> \n  select(region_name, location_code, type, year, TFR) |> \n  filter(type == \"Country/Area\", year %in% c(1950, 1990, 2024, 2100)) |> \n  pivot_wider(\n    id_cols = c(region_name, location_code, type), \n    names_from = year,\n    values_from = TFR\n  ) |> \n  rename(\n    y1950 = `1950`,\n    y1990 = `1990`,\n    y2024 = `2024`,\n    y2100 = `2100`\n  )\n```\n:::\n\n\n-   결합하기\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnew_world <- countries_m |> \n  left_join(wpp_TFR, join_by(ISO_N3_CD == location_code))\nnew_tiny <- tiny_m |> \n  left_join(wpp_TFR, join_by(ISO_N3_CD == location_code))\n```\n:::\n\n\n### 4가지 계급구분 방법: 서울\n\n#### 평범한 지도\n\n-   최대값과 최소값의 계산\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmin_val <- seoul_df |> pull(House1_p) |> min() |> format(digits = 1, nsmall = 1)\nmax_val <- seoul_df |> pull(House1_p) |> max() |> format(digits = 1, nsmall = 1)\n```\n:::\n\n\n-   지도 제작\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmy_map <- tm_shape(seoul_df) + \n  tm_polygons(\n    col = \"House1_p\", palette = \"BuPu\", \n    breaks = c(-Inf, 15, 25, 35, 45, 55, 65, Inf),\n    labels = c(paste0(\"< 15\", \" (Min. \", min_val, \")\"), \"15 ~ 25\", \"25 ~ 35\", \"35 ~ 45\", \"45 ~ 55\", \"55 ~ 65\", \n               paste0(\">= 65\", \" (Max. \", max_val, \")\")),\n    title = \"One-Person (%)\", \n    legend.hist = TRUE\n  ) +\n  tm_shape(seoul_gu) + tm_borders(lwd = 1.5, col = \"black\") +\n  tm_legend(legend.title.size = 1.2, legend.text.size = 1, legend.position = c(0.1, 0.43), \n            legend.frame = FALSE, legend.hist.size = 1, legend.hist.width = 0.7, legend.hist.height = 0.25) +\n  tm_layout(title = \"One-Person (2020)\", title.size = 1.5, title.position = c(\"center\", \"top\"),\n            legend.outside = TRUE, inner.margins = c(0.05, 0.05, 0.05, 0.05)) +\n  tm_scale_bar(\n    color.dark = \"gray60\", text.size = 0.4, breaks = seq(0, 10, 2), position = c(0.03, 0.01)) + \n  tm_credits(\"SANG-IL LEE, Geography Education at SNU, 2024\", size = 0.5, position = c(0.79, 0.01))\nmy_map\n```\n\n::: {.cell-output-display}\n![](13_chropleth_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n\n-   저장\n\n\n::: {.cell}\n\n:::\n\n\n#### 자연단절 분류법\n\n-   지도 제작\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmy_map <- tm_shape(seoul_df) + \n  tm_polygons(\n    col = \"House1_p\", palette = \"BuPu\", \n    style = \"jenks\", n = 7, \n    title = \"One-Person (%)\", \n    legend.hist = TRUE\n  ) +\n  tm_shape(seoul_gu) + tm_borders(lwd = 1.5, col = \"black\") +\n  tm_legend(legend.format = list(digits = 1), \n            legend.title.size = 1.2, legend.text.size = 1, legend.position = c(0.1, 0.43), \n            legend.frame = FALSE, legend.hist.size = 1, legend.hist.width = 0.7, legend.hist.height = 0.25) +\n  tm_layout(title = \"One-Person (2020)\", title.size = 1.5, title.position = c(\"center\", \"top\"),\n            legend.outside = TRUE, inner.margins = c(0.05, 0.05, 0.05, 0.05)) +\n  tm_scale_bar(\n    color.dark = \"gray60\", text.size = 0.4, breaks = seq(0, 10, 2), position = c(0.03, 0.01)) + \n  tm_credits(text = \"Natural Breaks (Jenks)\", size = 2, position = c(0.05, 0.9)) +\n  tm_credits(\"SANG-IL LEE, Geography Education at SNU, 2024\", size = 0.5, position = c(0.79, 0.01))\nmy_map\n```\n\n::: {.cell-output-display}\n![](13_chropleth_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n:::\n\n\n-   저장\n\n\n::: {.cell}\n\n:::\n\n\n#### 등개수 분류법\n\n-   지도 제작\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmy_map <- tm_shape(seoul_df) + \n  tm_polygons(\n    col = \"House1_p\", palette = \"BuPu\", \n    style = \"quantile\", n = 7, \n    title = \"One-Person (%)\", \n    legend.hist = TRUE\n  ) +\n  tm_shape(seoul_gu) + tm_borders(lwd = 1.5, col = \"black\") +\n  tm_legend(legend.format = list(digits = 1),\n            legend.title.size = 1.2, legend.text.size = 1, legend.position = c(0.1, 0.43), \n            legend.frame = FALSE, legend.hist.size = 1, legend.hist.width = 0.7, legend.hist.height = 0.25) +\n  tm_layout(title = \"One-Person (2020)\", title.size = 1.5, title.position = c(\"center\", \"top\"),\n            legend.outside = TRUE, inner.margins = c(0.05, 0.05, 0.05, 0.05)) +\n  tm_scale_bar(\n    color.dark = \"gray60\", text.size = 0.4, breaks = seq(0, 10, 2), position = c(0.03, 0.01)) + \n  tm_credits(text = \"Quantile\", size = 2, position = c(0.05, 0.9)) +\n  tm_credits(\"SANG-IL LEE, Geography Education at SNU, 2024\", size = 0.5, position = c(0.79, 0.01))\nmy_map\n```\n\n::: {.cell-output-display}\n![](13_chropleth_files/figure-html/unnamed-chunk-13-1.png){width=672}\n:::\n:::\n\n\n-   저장\n\n\n::: {.cell}\n\n:::\n\n\n#### 등간격 분류법\n\n-   지도 제작\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmy_map <- tm_shape(seoul_df) + \n  tm_polygons(\n    col = \"House1_p\", palette = \"BuPu\", \n    style = \"equal\", n = 7, \n    title = \"One-Person (%)\", \n    legend.hist = TRUE\n  ) +\n  tm_shape(seoul_gu) + tm_borders(lwd = 1.5, col = \"black\") +\n  tm_legend(legend.format = list(digits = 1), \n            legend.title.size = 1.2, legend.text.size = 1, legend.position = c(0.1, 0.43), \n            legend.frame = FALSE, legend.hist.size = 1, legend.hist.width = 0.7, legend.hist.height = 0.25) +\n  tm_layout(title = \"One-Person (2020)\", title.size = 1.5, title.position = c(\"center\", \"top\"),\n            legend.outside = TRUE, inner.margins = c(0.05, 0.05, 0.05, 0.05)) +\n  tm_scale_bar(\n    color.dark = \"gray60\", text.size = 0.4, breaks = seq(0, 10, 2), position = c(0.03, 0.01)) + \n  tm_credits(text = \"Equal Interval\", size = 2, position = c(0.05, 0.9)) +\n  tm_credits(\"SANG-IL LEE, Geography Education at SNU, 2024\", size = 0.5, position = c(0.79, 0.01))\nmy_map\n```\n\n::: {.cell-output-display}\n![](13_chropleth_files/figure-html/unnamed-chunk-15-1.png){width=672}\n:::\n:::\n\n\n-   저장\n\n\n::: {.cell}\n\n:::\n\n\n#### 표준편차 분류법\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmy_map <- tm_shape(seoul_df) + \n  tm_polygons(\n    col = \"House1_p\", palette = \"BuPu\", \n    style = \"sd\", n = 7, \n    title = \"One-Person (%)\", \n    legend.hist = TRUE \n  ) +\n  tm_shape(seoul_gu) + tm_borders(lwd = 1.5, col = \"black\") +\n  tm_legend(legend.format = list(digits = 1), \n            legend.title.size = 1.2, legend.text.size = 1, legend.position = c(0.1, 0.43), \n            legend.frame = FALSE, legend.hist.size = 1, legend.hist.width = 0.7, legend.hist.height = 0.25) +\n  tm_layout(title = \"One-Person (2020)\", title.size = 1.5, title.position = c(\"center\", \"top\"),\n            legend.outside = TRUE, inner.margins = c(0.05, 0.05, 0.05, 0.05)) +\n  tm_scale_bar(\n    color.dark = \"gray60\", text.size = 0.4, breaks = seq(0, 10, 2), position = c(0.03, 0.01)) + \n  tm_credits(text = \"Standard Deviation\", size = 2, position = c(0.05, 0.9)) +\n  tm_credits(\"SANG-IL LEE, Geography Education at SNU, 2024\", size = 0.5, position = c(0.79, 0.01))\nmy_map\n```\n\n::: {.cell-output-display}\n![](13_chropleth_files/figure-html/unnamed-chunk-17-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n:::\n\n\n#### 무분류\n\n-   지도 제작\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmy_map <- tm_shape(seoul_df) + \n  tm_polygons(\n    col = \"House1_p\", palette = \"BuPu\", \n    style = \"cont\", \n    breaks = seq(0, 80, 10),\n    title = \"One-Person (%)\", \n    legend.hist = FALSE, legend.hist.width = 1\n  ) +\n  tm_shape(seoul_gu) + tm_borders(lwd = 1.5, col = \"black\") +\n  tm_legend(legend.title.size = 1.2, legend.text.size = 1, legend.position = c(0.1, 0.43),  \n            legend.frame = FALSE, legend.hist.size = 1, legend.hist.width = 0.7, legend.hist.height = 0.25) +\n  tm_layout(title = \"One-Person (2020)\", title.size = 1.5, title.position = c(\"center\", \"top\"),\n            legend.outside = TRUE, inner.margins = c(0.05, 0.05, 0.05, 0.05)) +\n  tm_scale_bar(\n    color.dark = \"gray60\", text.size = 0.4, breaks = seq(0, 10, 2), position = c(0.03, 0.01)) + \n  tm_credits(text = \"Unclassed\", size = 2, position = c(0.05, 0.9)) +\n  tm_credits(\"SANG-IL LEE, Geography Education at SNU, 2024\", size = 0.5, position = c(0.79, 0.01))\nmy_map\n```\n\n::: {.cell-output-display}\n![](13_chropleth_files/figure-html/unnamed-chunk-19-1.png){width=672}\n:::\n:::\n\n\n-   저장\n\n\n::: {.cell}\n\n:::\n\n\n### 등개수 분류법과 등간격 분류법의 비교: 세계 TFR\n\n#### 등개수 분류법: 1955년\n\n-   지도 제작\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmy_map <- tm_shape(grat_bb_m, projection = \"+proj=robin\") + tm_borders(lwd = 1) + \n  tm_shape(grat_30_m) + tm_lines(lwd = 0.2) +\n  tm_shape(new_world) +\n  tm_polygons(\n    col = \"y1950\", style = \"quantile\", n = 5, palette = \"Reds\", \n    title = \"TFR, 1950\", \n    legend.hist = TRUE) +\n  tm_shape(tiny_m) + tm_dots(size = 0.01) +\n  tm_legend(legend.format = list(digits = 3), legend.title.size = 1.4, legend.text.size = 1.1, \n            legend.position = c(\"left\", \"bottom\"), \n            legend.frame = TRUE, legend.hist.width = 0.15, legend.hist.height = 0.2, legend.hist.size = 0.8, \n            legend.bg.color = \"gray95\", legend.stack = \"vertical\", legend.width = 0.35) +\n  tm_layout(frame = FALSE, bg.color = \"White\", inner.margins = c(0.01, 0.01, 0.02, 0.01)) +\n  tm_credits(\"SANG-IL LEE, Geography Education at SNU, 2024\", size = 0.5, position = c(0.55, 0.02))\nmy_map\n```\n\n::: {.cell-output-display}\n![](13_chropleth_files/figure-html/unnamed-chunk-21-1.png){width=672}\n:::\n:::\n\n\n-   저장\n\n\n::: {.cell}\n\n:::\n\n\n#### 등개수 분류법: 1990년\n\n-   지도 제작\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmy_map <- tm_shape(grat_bb_m, projection = \"+proj=robin\") + tm_borders(lwd = 1) + \n  tm_shape(grat_30_m) + tm_lines(lwd = 0.2) +\n  tm_shape(new_world) +\n  tm_polygons(\n    col = \"y1990\", style = \"quantile\", n = 5, palette = \"Reds\", \n    title = \"TFR, 1990\", \n    legend.hist = TRUE) +\n  tm_shape(tiny_m) + tm_dots(size = 0.01) +\n  tm_legend(legend.format = list(digits = 3), legend.title.size = 1.4, legend.text.size = 1.1, \n            legend.position = c(\"left\", \"bottom\"), \n            legend.frame = TRUE, legend.hist.width = 0.15, legend.hist.height = 0.2, legend.hist.size = 0.8, \n            legend.bg.color = \"gray95\", legend.stack = \"vertical\", legend.width = 0.35) +\n  tm_layout(frame = FALSE, bg.color = \"White\", inner.margins = c(0.01, 0.01, 0.02, 0.01)) +\n  tm_credits(\"SANG-IL LEE, Geography Education at SNU, 2024\", size = 0.5, position = c(0.55, 0.02))\nmy_map\n```\n\n::: {.cell-output-display}\n![](13_chropleth_files/figure-html/unnamed-chunk-23-1.png){width=672}\n:::\n:::\n\n\n-   저장\n\n\n::: {.cell}\n\n:::\n\n\n#### 등개수 분류법: 2024년\n\n-   지도 제작\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmy_map <- tm_shape(grat_bb_m, projection = \"+proj=robin\") + tm_borders(lwd = 1) + \n  tm_shape(grat_30_m) + tm_lines(lwd = 0.2) +\n  tm_shape(new_world) +\n  tm_polygons(\n    col = \"y2024\", style = \"quantile\", n = 5, palette = \"Reds\", \n    title = \"TFR, 2024\", \n    legend.hist = TRUE) +\n  tm_shape(tiny_m) + tm_dots(size = 0.01) +\n  tm_legend(legend.format = list(digits = 3), legend.title.size = 1.4, legend.text.size = 1.1, \n            legend.position = c(\"left\", \"bottom\"), \n            legend.frame = TRUE, legend.hist.width = 0.15, legend.hist.height = 0.2, legend.hist.size = 0.8, \n            legend.bg.color = \"gray95\", legend.stack = \"vertical\", legend.width = 0.35) +\n  tm_layout(frame = FALSE, bg.color = \"White\", inner.margins = c(0.01, 0.01, 0.02, 0.01)) +\n  tm_credits(\"SANG-IL LEE, Geography Education at SNU, 2024\", size = 0.5, position = c(0.55, 0.02))\nmy_map\n```\n\n::: {.cell-output-display}\n![](13_chropleth_files/figure-html/unnamed-chunk-25-1.png){width=672}\n:::\n:::\n\n\n-   저장\n\n\n::: {.cell}\n\n:::\n\n\n#### 등개수 분류법: 2100년\n\n-   지도 제작\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmy_map <- tm_shape(grat_bb_m, projection = \"+proj=robin\") + tm_borders(lwd = 1) + \n  tm_shape(grat_30_m) + tm_lines(lwd = 0.2) +\n  tm_shape(new_world) +\n  tm_polygons(\n    col = \"y2100\", style = \"quantile\", n = 5, palette = \"Reds\", \n    title = \"TFR, 2100\", \n    legend.hist = TRUE) +\n  tm_shape(tiny_m) + tm_dots(size = 0.01) +\n  tm_legend(legend.format = list(digits = 3), legend.title.size = 1.4, legend.text.size = 1.1, \n            legend.position = c(\"left\", \"bottom\"), \n            legend.frame = TRUE, legend.hist.width = 0.15, legend.hist.height = 0.2, legend.hist.size = 0.8, \n            legend.bg.color = \"gray95\", legend.stack = \"vertical\", legend.width = 0.35) +\n  tm_layout(frame = FALSE, bg.color = \"White\", inner.margins = c(0.01, 0.01, 0.02, 0.01)) +\n  tm_credits(\"SANG-IL LEE, Geography Education at SNU, 2024\", size = 0.5, position = c(0.55, 0.02))\nmy_map\n```\n\n::: {.cell-output-display}\n![](13_chropleth_files/figure-html/unnamed-chunk-27-1.png){width=672}\n:::\n:::\n\n\n-   저장\n\n\n::: {.cell}\n\n:::\n\n\n#### 등간격 분류법: 1950년\n\n-   지도 제작\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmy_map <- tm_shape(grat_bb_m, projection = \"+proj=robin\") + tm_borders(lwd = 1) + \n  tm_shape(grat_30_m) + tm_lines(lwd = 0.2) +\n  tm_shape(new_world) +\n  tm_polygons(\n    col = \"y1950\", style = \"fixed\", n = 5, palette = \"Reds\", \n    breaks = c(-Inf, 2.347, 3.912, 5.477, 7.042, Inf), \n    labels = c(\"0.782 ~ 2.347\", \"2.347 ~ 3.912\", \"3.912 ~ 5.477\", \"5.477 ~ 7.042\", \"7.042 ~ 8.606\"), \n    title = \"TFR, 1950\", \n    legend.hist = TRUE) +\n  tm_shape(tiny_m) + tm_dots(size = 0.01) +\n  tm_legend(legend.format = list(digits = 3), legend.title.size = 1.4, legend.text.size = 1.1, \n            legend.position = c(\"left\", \"bottom\"), \n            legend.frame = TRUE, legend.hist.width = 0.15, legend.hist.height = 0.2, legend.hist.size = 0.8, \n            legend.bg.color = \"gray95\", legend.stack = \"vertical\", legend.width = 0.35) +\n  tm_layout(frame = FALSE, bg.color = \"White\", inner.margins = c(0.01, 0.01, 0.02, 0.01)) +\n  tm_credits(\"SANG-IL LEE, Geography Education at SNU, 2024\", size = 0.5, position = c(0.55, 0.02))\nmy_map\n```\n\n::: {.cell-output-display}\n![](13_chropleth_files/figure-html/unnamed-chunk-29-1.png){width=672}\n:::\n:::\n\n\n-   저장\n\n\n::: {.cell}\n\n:::\n\n\n#### 등간격 분류법: 1990년\n\n-   지도 제작\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmy_map <- tm_shape(grat_bb_m, projection = \"+proj=robin\") + tm_borders(lwd = 1) + \n  tm_shape(grat_30_m) + tm_lines(lwd = 0.2) +\n  tm_shape(new_world) +\n  tm_polygons(\n    col = \"y1990\", style = \"fixed\", n = 5, palette = \"Reds\", \n    breaks = c(-Inf, 2.347, 3.912, 5.477, 7.042, Inf), \n    labels = c(\"0.782 ~ 2.347\", \"2.347 ~ 3.912\", \"3.912 ~ 5.477\", \"5.477 ~ 7.042\", \"7.042 ~ 8.606\"), \n    title = \"TFR, 1990\", \n    legend.hist = TRUE) +\n  tm_shape(tiny_m) + tm_dots(size = 0.01) +\n  tm_legend(legend.format = list(digits = 3), legend.title.size = 1.4, legend.text.size = 1.1, \n            legend.position = c(\"left\", \"bottom\"), \n            legend.frame = TRUE, legend.hist.width = 0.15, legend.hist.height = 0.2, legend.hist.size = 0.8, \n            legend.bg.color = \"gray95\", legend.stack = \"vertical\", legend.width = 0.35) +\n  tm_layout(frame = FALSE, bg.color = \"White\", inner.margins = c(0.01, 0.01, 0.02, 0.01)) +\n  tm_credits(\"SANG-IL LEE, Geography Education at SNU, 2024\", size = 0.5, position = c(0.55, 0.02))\nmy_map\n```\n\n::: {.cell-output-display}\n![](13_chropleth_files/figure-html/unnamed-chunk-31-1.png){width=672}\n:::\n:::\n\n\n-   저장\n\n\n::: {.cell}\n\n:::\n\n\n#### 등간격 분류법: 2024년\n\n-   지도 제작\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmy_map <- tm_shape(grat_bb_m, projection = \"+proj=robin\") + tm_borders(lwd = 1) + \n  tm_shape(grat_30_m) + tm_lines(lwd = 0.2) +\n  tm_shape(new_world) +\n  tm_polygons(\n    col = \"y2024\", style = \"fixed\", n = 5, palette = \"Reds\", \n    breaks = c(-Inf, 2.347, 3.912, 5.477, 7.042, Inf), \n    labels = c(\"0.782 ~ 2.347\", \"2.347 ~ 3.912\", \"3.912 ~ 5.477\", \"5.477 ~ 7.042\", \"7.042 ~ 8.606\"), \n    title = \"TFR, 2024\", \n    legend.hist = TRUE) +\n  tm_shape(tiny_m) + tm_dots(size = 0.01) +\n  tm_legend(legend.format = list(digits = 3), legend.title.size = 1.4, legend.text.size = 1.1, \n            legend.position = c(\"left\", \"bottom\"), \n            legend.frame = TRUE, legend.hist.width = 0.15, legend.hist.height = 0.2, legend.hist.size = 0.8, \n            legend.bg.color = \"gray95\", legend.stack = \"vertical\", legend.width = 0.35) +\n  tm_layout(frame = FALSE, bg.color = \"White\", inner.margins = c(0.01, 0.01, 0.02, 0.01)) +\n  tm_credits(\"SANG-IL LEE, Geography Education at SNU, 2024\", size = 0.5, position = c(0.55, 0.02))\nmy_map\n```\n\n::: {.cell-output-display}\n![](13_chropleth_files/figure-html/unnamed-chunk-33-1.png){width=672}\n:::\n:::\n\n\n-   저장\n\n\n::: {.cell}\n\n:::\n\n\n#### 등간격 분류법: 2100년\n\n-   지도 제작\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmy_map <- tm_shape(grat_bb_m, projection = \"+proj=robin\") + tm_borders(lwd = 1) + \n  tm_shape(grat_30_m) + tm_lines(lwd = 0.2) +\n  tm_shape(new_world) +\n  tm_polygons(\n    col = \"y2100\", style = \"fixed\", n = 5, palette = \"Reds\", \n    breaks = c(-Inf, 2.347, 3.912, 5.477, 7.042, Inf), \n    labels = c(\"0.782 ~ 2.347\", \"2.347 ~ 3.912\", \"3.912 ~ 5.477\", \"5.477 ~ 7.042\", \"7.042 ~ 8.606\"), \n    title = \"TFR, 2100\", \n    legend.hist = TRUE) +\n  tm_shape(tiny_m) + tm_dots(size = 0.01) +\n  tm_legend(legend.format = list(digits = 3), legend.title.size = 1.4, legend.text.size = 1.1, \n            legend.position = c(\"left\", \"bottom\"), \n            legend.frame = TRUE, legend.hist.width = 0.15, legend.hist.height = 0.2, legend.hist.size = 0.8, \n            legend.bg.color = \"gray95\", legend.stack = \"vertical\", legend.width = 0.35) +\n  tm_layout(frame = FALSE, bg.color = \"White\", inner.margins = c(0.01, 0.01, 0.02, 0.01)) +\n  tm_credits(\"SANG-IL LEE, Geography Education at SNU, 2024\", size = 0.5, position = c(0.55, 0.02))\nmy_map\n```\n\n::: {.cell-output-display}\n![](13_chropleth_files/figure-html/unnamed-chunk-35-1.png){width=672}\n:::\n:::\n\n\n-   저장\n\n\n::: {.cell}\n\n:::\n\n\n#### 비분류: 2024년\n\n-   지도 제작\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmy_map <- tm_shape(grat_bb_m, projection = \"+proj=robin\") + tm_borders(lwd = 1) + \n  tm_shape(grat_30_m) + tm_lines(lwd = 0.2) +\n  tm_shape(new_world) +\n  tm_polygons(\n    col = \"y2024\", style = \"cont\", palette = \"Reds\", \n    breaks = seq(0, 7, 1), \n    title = \"TFR, 2024\", \n    legend.hist = FALSE) +\n  tm_shape(tiny_m) + tm_dots(size = 0.01) +\n  tm_legend(legend.format = list(digits = 0), legend.title.size = 1.4, legend.text.size = 1.1, \n            legend.position = c(\"left\", \"bottom\"), \n            legend.frame = TRUE, legend.hist.width = 0.15, legend.hist.height = 0.2, legend.hist.size = 0.8, \n            legend.bg.color = \"gray95\", legend.stack = \"vertical\", legend.width = 0.35) +\n  tm_layout(frame = FALSE, bg.color = \"White\", inner.margins = c(0.01, 0.01, 0.02, 0.01)) +\n  tm_credits(\"SANG-IL LEE, Geography Education at SNU, 2024\", size = 0.5, position = c(0.55, 0.02))\nmy_map\n```\n\n::: {.cell-output-display}\n![](13_chropleth_files/figure-html/unnamed-chunk-37-1.png){width=672}\n:::\n:::\n\n\n-   저장\n\n\n::: {.cell}\n\n:::\n\n\n## 색 배열(color scheme)\n\n### 함수\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsnu.color.scheme.generator <- function(sel, type){\n  if (type == \"seq\"){\n    col.schemes <- c(\"YlGn\", \"YlGnBu\", \"GnBu\", \"BuGn\", \"PuBuGn\", \"PuBu\", \"BuPu\", \"RdPu\", \"PuRd\", \n                     \"OrRd\", \"YlOrRd\", \"YlOrBr\", \"Purples\", \"Blues\", \"Greens\", \"Oranges\", \"Reds\", \"Greys\")\n  }\n  else if(type == \"div\"){\n    col.schemes <- c(\"PuOr\", \"BrBG\", \"PRGn\", \"PiYG\", \"RdBu\", \"RdGy\", \"RdYlBu\", \"Spectral\", \"RdYlGn\")\n  }\n  else {col.schemes = c(\"Set3\", \"Pastel1\", \"Set1\", \"Pastel2\", \"Set2\", \"Dark2\", \"Paired\", \"Accent\")}\n  col.sel <- col.schemes[sel]\n  n <- length(sel)\n  map.name.list <- list()\n  i <- 1\n  for (i in 1:n){\n    my.pal <- col.sel[i]\n    var.sel <- \"House1_p\"\n    map.name <- paste0(my.pal, \".map\")\n    map.name <- tm_shape(seoul_df) + \n      tm_polygons(\n        col = var.sel, palette = my.pal, \n        breaks = c(-Inf, 15, 25, 35, 45, 55, 65, Inf),\n        legend.show = FALSE\n      ) +\n      tm_shape(seoul_gu) + tm_borders(lwd = 1.5, col = \"black\") +\n      tm_legend(legend.title.size = 1.2, legend.text.size = 1, legend.position = c(0.1, 0.43), \n                legend.frame = FALSE, legend.hist.size = 1, legend.hist.width = 0.7, legend.hist.height = 0.25) +\n      tm_layout(legend.outside = TRUE, inner.margins = c(0.05, 0.05, 0.05, 0.05)) +\n      # tm_scale_bar(color.dark = \"gray60\", text.size = 0.4, breaks = seq(0, 10, 2), position = c(0.03, 0.01)) + \n      # tm_credits(\"SANG-IL LEE, Geograhy Education at SNU, 2024\", size = 0.5, position = c(0.79, 0.01)) +\n      tm_credits(text = my.pal, size = 1, position = c(0.05, 0.75))\n      map.name.list[[i]] <- map.name\n  }\n  map.name.list\n}\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nsnu.color.scheme.generator <- function(sel, type){\n  if (type == \"seq\"){\n    col.schemes <- c(\"YlGn\", \"YlGnBu\", \"GnBu\", \"BuGn\", \"PuBuGn\", \"PuBu\", \"BuPu\", \"RdPu\", \"PuRd\", \n                     \"OrRd\", \"YlOrRd\", \"YlOrBr\", \"Purples\", \"Blues\", \"Greens\", \"Oranges\", \"Reds\", \"Greys\")\n  }\n  else if(type == \"div\"){\n    col.schemes <- c(\"PuOr\", \"BrBG\", \"PRGn\", \"PiYG\", \"RdBu\", \"RdGy\", \"RdYlBu\", \"Spectral\", \"RdYlGn\")\n  }\n  else {col.schemes = c(\"Set3\", \"Pastel1\", \"Set1\", \"Pastel2\", \"Set2\", \"Dark2\", \"Paired\", \"Accent\")}\n  col.sel <- col.schemes[sel]\n  n <- length(sel)\n  map.name.list <- list()\n  for (i in 1:n){\n    my.pal <- col.sel[i]\n    var.sel <- \"House1_p\"\n    map.name <- paste0(my.pal, \".map\")\n    if (type == \"seq\" | type == \"div\"){\n       map.name <- tm_shape(seoul_df) + \n         tm_polygons(\n           col = var.sel, palette = my.pal, \n           breaks = c(-Inf, 15, 25, 35, 45, 55, 65, Inf),\n           legend.show = FALSE\n           ) +\n         tm_shape(seoul_gu) + tm_borders(lwd = 1.5, col = \"black\") +\n         tm_legend(legend.title.size = 1.2, legend.text.size = 1, legend.position = c(0.1, 0.43), \n                   legend.frame = FALSE, legend.hist.size = 1, legend.hist.width = 0.7, legend.hist.height = 0.25) +\n         tm_layout(legend.outside = TRUE, inner.margins = c(0.05, 0.05, 0.05, 0.05)) +\n         tm_credits(text = my.pal, size = 1, position = c(0.05, 0.85))\n       map.name.list[[i]] <- map.name\n    }\n    else{\n      map.name <- tm_shape(seoul_df) +\n        tm_polygons(col = \"MAP_COLORS\", palette = my.pal) +\n        tm_shape(seoul_gu) + tm_borders(lwd = 1.5, col = \"black\") +\n        tm_layout(legend.outside = TRUE, inner.margins = c(0.05, 0.05, 0.05, 0.05)) +\n        tm_credits(text = my.pal, size = 1, position = c(0.05, 0.85))\n      map.name.list[[i]] <- map.name\n    }\n  }\n  map.name.list\n}\n```\n:::\n\n\n### 순차 배열\n\n-   지도 제작과 저장 1\n\n\n::: {.cell}\n\n```{.r .cell-code}\nseq.1 <- snu.color.scheme.generator(1:9, type = \"seq\")\ncol.seq.1 <- tmap_arrange(seq.1[[1]], seq.1[[2]], seq.1[[3]], seq.1[[4]], seq.1[[5]], seq.1[[6]], \n                          seq.1[[7]], seq.1[[8]], seq.1[[9]], ncol = 3)\nmy_title <- \"13_5_01\"\nmy.path.name <- \"outputs/\"\nmy.file.name <- paste0(my.path.name, my_title, \".png\")\ntmap_save(\n  col.seq.1, \n  filename = my.file.name, \n  width = 15, height = 12, \n  dpi = 600)\n```\n:::\n\n\n-   지도 제작과 저장 2\n\n\n::: {.cell}\n\n```{.r .cell-code}\nseq.2 <- snu.color.scheme.generator(10:18, type = \"seq\")\ncol.seq.2 <- tmap_arrange(seq.2[[1]], seq.2[[2]], seq.2[[3]], seq.2[[4]], seq.2[[5]], seq.2[[6]], \n                          seq.2[[7]], seq.2[[8]], seq.2[[9]], ncol = 3)\nmy_title <- \"13_5_02\"\nmy.path.name <- \"outputs/\"\nmy.file.name <- paste0(my.path.name, my_title, \".png\")\ntmap_save(\n  col.seq.2, \n  filename = my.file.name, \n  width = 15, height = 12, \n  dpi = 600)\n```\n:::\n\n\n### 분기 배열\n\n-   지도 제작 및 저장\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndiv <- snu.color.scheme.generator(1:9, type = \"div\")\ncol.div <- tmap_arrange(div[[1]], div[[2]], div[[3]], div[[4]], div[[5]], div[[6]], \n                        div[[7]], div[[8]], div[[9]], ncol = 3)\nmy_title <- \"13_5_03\"\nmy.path.name <- \"outputs/\"\nmy.file.name <- paste0(my.path.name, my_title, \".png\")\ntmap_save(\n  col.div, \n  filename = my.file.name, \n  width = 15, height = 12, \n  dpi = 600)\n```\n:::\n\n\n### 정성적 배열\n\n\n::: {.cell}\n\n```{.r .cell-code}\nqual <- snu.color.scheme.generator(1:8, type = \"qual\")\ncol.qual <- tmap_arrange(qual[[1]], qual[[2]], qual[[3]], qual[[4]], qual[[5]], qual[[6]], \n                         qual[[7]], qual[[8]], ncol = 3)\nmy_title <- \"13_5_04\"\nmy.path.name <- \"outputs/\"\nmy.file.name <- paste0(my.path.name, my_title, \".png\")\ntmap_save(\n  col.qual, \n  filename = my.file.name, \n  width = 15, height = 12, \n  dpi = 600)\n```\n:::\n\n\n## 공간단위의 차이\n\n### 서울시의 경우: 1인가구 비중\n\n#### 읍면동 수준\n\n-   지도 제작\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmy_map <- tm_shape(seoul_df) + \n  tm_polygons(\n    col = \"House1_p\", palette = \"BuPu\", \n    breaks = c(-Inf, 15, 25, 35, 45, 55, 65, Inf),\n    labels = c(\"< 15\", \"15 ~ 25\", \"25 ~ 35\", \"35 ~ 45\", \"45 ~ 55\", \"55 ~ 65\", \">= 65\"),\n    title = \"Proportion (%)\", \n  ) +\n  tm_shape(seoul_gu) + tm_borders(lwd = 1.5, col = \"black\") +\n  tm_legend(legend.title.size = 1.4, legend.text.size = 1.2, legend.position = c(0.87, 0.05), \n            legend.frame = FALSE) +\n  tm_layout(title = \"One-Person Households, 2020\", title.size = 2, title.position = c(\"left\", \"top\"),\n            legend.outside = FALSE, inner.margins = c(0.05, 0.05, 0.05, 0.1)) +\n  tm_scale_bar(\n    color.dark = \"gray60\", text.size = 0.4, breaks = seq(0, 10, 2), position = c(0.03, 0.01)) + \n  tm_credits(\"SANG-IL LEE, Geography Education at SNU, 2024\", size = 0.7, position = c(0.79, 0.01))\nmy_map\n```\n\n::: {.cell-output-display}\n![](13_chropleth_files/figure-html/unnamed-chunk-45-1.png){width=672}\n:::\n:::\n\n\n-   저장\n\n\n::: {.cell}\n\n:::\n\n\n#### 시군구 수준\n\n-   데이터\n\n\n::: {.cell}\n\n```{.r .cell-code}\nseoul_gu_df <-seoul_gu |> \n  left_join(\n    house_SDGGEMD_2020, join_by(SGG1_CD == Code)\n  )\n```\n:::\n\n\n-   지도 제작\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmy_map <- tm_shape(seoul_gu_df) + \n  tm_polygons(\n    col = \"House1_p\", palette = \"BuPu\", \n    breaks = c(-Inf, 15, 25, 35, 45, 55, 65, Inf),\n    labels = c(\"< 15\", \"15 ~ 25\", \"25 ~ 35\", \"35 ~ 45\", \"45 ~ 55\", \"55 ~ 65\", \">= 65\"),\n    title = \"Proportion (%)\", \n  ) +\n  tm_shape(seoul_gu) + tm_borders(lwd = 1.5, col = \"black\") +\n  tm_legend(legend.title.size = 1.4, legend.text.size = 1.2, legend.position = c(0.87, 0.05), \n            legend.frame = FALSE) +\n  tm_layout(title = \"One-Person Households, 2020\", title.size = 2, title.position = c(\"left\", \"top\"),\n            legend.outside = FALSE, inner.margins = c(0.05, 0.05, 0.05, 0.1)) +\n  tm_scale_bar(\n    color.dark = \"gray60\", text.size = 0.4, breaks = seq(0, 10, 2), position = c(0.03, 0.01)) + \n  tm_credits(\"SANG-IL LEE, Geography Education at SNU, 2024\", size = 0.7, position = c(0.79, 0.01))\nmy_map\n```\n\n::: {.cell-output-display}\n![](13_chropleth_files/figure-html/unnamed-chunk-48-1.png){width=672}\n:::\n:::\n\n\n-   저장\n\n\n::: {.cell}\n\n:::\n",
    "supporting": [
      "13_chropleth_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}